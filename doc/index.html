<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>飘刃</title>
  <link rel="stylesheet" href="./vs2015.css">
  <style>
  body {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
    font-family: "Microsoft Yahei", "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif;
    line-height: 1.75;
    margin-right: 150px;
    color: #2a2a2a;
  }
  code {
    font-family: Consolas;
    font-size: 14px;
  }
  table {
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #eee;
    padding: 4px 20px;
  }
  .content {
    padding: 20px;
    max-width: 882px;
    margin: 0 auto;
  }
  blockquote {
    border-left: .25em solid #dfe2e5;
    color: #6a737d;
    padding: 0 1em;
    margin: 0;
  }
  #ad {
    border: none;
    width: 100%;
    position: fixed;
    right: 10px;
    top: 38px;
    width: 120px;
    height: 600px;
    background: #000;
  }
  .big {
      display: block;
  }
  .small {
    display: none;
  }
  #ad img {
    display: block;
    margin: 0 auto;
  }
  @media screen and (max-width: 768px) {
    #ad {
      top: auto;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 48px;
    }
    .content {
      width: 100%;
      position: absolute;
      box-sizing: border-box;
      padding-bottom: 100px;
    }
    .big {
        display: none;
      }
    .small {
      display: block;
    }
  }
  </style>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?13d1748106859cff17352f69a8fa8457";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
</head>
<body>
  <!-- <a target="_blank" href="https://github.com/chjtx/pr1"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 9" src="http://www.chjtx.com/assets/images/jtaro-github-ribbon.png"></a> -->
  <div class="content"><h1>飘刃 (Piao Ren)</h1>
<p>约定大于配置的极速 Web 应用打包工具，支持 .vue 文件，生产使用 Rollup 打包</p>
<blockquote>
<p>仅供学习研究，请勿用于生产</p>
</blockquote>
<h2>仓库</h2>
<p>【Github】 <a target="_blank" href="https://github.com/chjtx/pr1">https://github.com/chjtx/pr1</a></p>
<p>【 码 云 】 <a target="_blank" href="https://gitee.com/chenjianlong/pr1">https://gitee.com/chenjianlong/pr1</a></p>
<h2>特点优势</h2>
<ul>
<li>速度快，开发过程中无需 babel 转译，飘刃只转 import/export ，其余直接输出到浏览器</li>
<li>效率高，使用谷歌浏览器 99.9% 源码调试，无需 source map ，告别组件 this 乱指 window</li>
<li>够直观，开发环境可在浏览器 Elements 调试板块直接从 dom 属性找到组件对应的文件位置</li>
<li>体积小，生产代码使用 rollup 打包，摇树优化，没用代码全靠边，再上 uglify 高效压缩</li>
</ul>
<h2>飘刃 VS Vue-CLI</h2>
<p><strong>对比环境</strong> 华为荣耀 MagicBook Windows 10 家庭版 i5 8G 64位 联通4G热点 30多个组件的小型 Vue 项目</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:left">飘刃</th>
<th style="text-align:left">Vue-CLI</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">工具版本</td>
<td style="text-align:left">piaoren@0.1.1</td>
<td style="text-align:left">@vue/cli@3.6.3</td>
</tr>
<tr>
<td style="text-align:center">依赖包数</td>
<td style="text-align:left">487</td>
<td style="text-align:left">689</td>
</tr>
<tr>
<td style="text-align:center">安装命令</td>
<td style="text-align:left">npm i -g piaoren</td>
<td style="text-align:left">npm i -g @vue/cli</td>
</tr>
<tr>
<td style="text-align:center">安装时间</td>
<td style="text-align:left">38s</td>
<td style="text-align:left">1m 42s</td>
</tr>
<tr>
<td style="text-align:center">支持编码</td>
<td style="text-align:left">Pug Sass ES6+</td>
<td style="text-align:left">Pug Sass Less Stylus ES6+ TypeScript</td>
</tr>
<tr>
<td style="text-align:center">创建项目</td>
<td style="text-align:left">pr1 init 只需要填项目名称</td>
<td style="text-align:left">vue create/vue init 需要填选多项</td>
</tr>
<tr>
<td style="text-align:center">启动命令</td>
<td style="text-align:left">pr1 start</td>
<td style="text-align:left">vue serve</td>
</tr>
<tr>
<td style="text-align:center">启动时间</td>
<td style="text-align:left">2s 与项目内容多少无关</td>
<td style="text-align:left">6.8s 项目内容多少决定</td>
</tr>
<tr>
<td style="text-align:center">热更响应</td>
<td style="text-align:left">支持更新 css 和刷新页面<br>两种方式，不支持 js 更新<br>更新 js 需要刷新页面<br>响应速度 立即</td>
<td style="text-align:left">支持 css 和 js 更新，vue 组件更新<br>有点鸡肋，很大概率需要手动更新<br>才能看到预期效果，每次变化都需<br>要编译，响应速度 稍慢</td>
</tr>
<tr>
<td style="text-align:center">打包工具</td>
<td style="text-align:left">Rollup</td>
<td style="text-align:left">Webpack</td>
</tr>
<tr>
<td style="text-align:center">打包时间</td>
<td style="text-align:left">5s 项目内容多少决定</td>
<td style="text-align:left">10s 项目内容多少决定</td>
</tr>
<tr>
<td style="text-align:center">静态资源</td>
<td style="text-align:left">暂只支持<code>.</code>和<code>/</code>开头<br>的静态资源</td>
<td style="text-align:left">支持<code>.</code>、<code>/</code>、<code>@</code>和<code>~</code><br>开头的静态资源</td>
</tr>
<tr>
<td style="text-align:center">多页应用</td>
<td style="text-align:left">无需配置</td>
<td style="text-align:left">需要配置 pages</td>
</tr>
<tr>
<td style="text-align:center">插件支持</td>
<td style="text-align:left">Rollup 插件规范</td>
<td style="text-align:left">Webpack 插件规范</td>
</tr>
<tr>
<td style="text-align:center">单元测试</td>
<td style="text-align:left">暂不支持</td>
<td style="text-align:left">可选</td>
</tr>
</tbody>
</table>
<p>总结：飘刃安装时间、启动速度、响应速度、打包时间都优于 Vue-CLI，但是配置方面不及 Vue-CLI 丰富。中小型无需配置的项目选择飘刃，大中型需要多方面资源配合的项目选择 Vue-CLI。</p>
<h2>快速上手</h2>
<pre class="hljs"><code>npm i -g piaoren
</code></pre>
<p>把飘刃安装到全局，任意目录都可以运行飘刃的命令 <code>pr1</code></p>
<pre class="hljs"><code>pr1 init

? Project name:           <span class="hljs-comment"># 项目名称至少两个字符，由大小写字母、中划线、下划线，及数字组成，数字不能为首字符</span>
? Project description:    <span class="hljs-comment"># 可不填</span>
</code></pre>
<p>将会自动生成项目名称命名的文件夹，包含若干工程文件</p>
<p>进入工程目录，执行以下命令开启开发模式</p>
<pre class="hljs"><code>npm run dev
</code></pre>
<ul>
<li>修改 src/main.js ，添加 Layout 组件</li>
</ul>
<pre class="hljs"><code><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue/dist/vue.esm.browser.js'</span>
<span class="hljs-keyword">import</span> Layout <span class="hljs-keyword">from</span> <span class="hljs-string">'./pages/Layout.vue'</span>

<span class="hljs-comment">// eslint-disable-next-line no-new</span>
<span class="hljs-keyword">new</span> Vue({
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
  <span class="hljs-attr">components</span>: {
    Layout
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;Layout/&gt;'</span>
})
</code></pre>
<ul>
<li>创建 src/pages 目录，并添加 src/pages/Layout.vue 文件</li>
</ul>
<pre class="hljs"><code><span class="hljs-comment">&lt;!-- pages/Layout.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"pug"</span>&gt;</span>
div
  div.top
    input(v-model="text")
    button(@click="submit") 添加
  ul
    Item(v-for="(i, k) in items" :name="i" :key="k")
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> Item <span class="hljs-keyword">from</span> <span class="hljs-string">'./Item.js'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: {
    Item
  },
  data () {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">text</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">items</span>: []
    }
  },
  <span class="hljs-attr">methods</span>: {
    submit () {
      <span class="hljs-keyword">this</span>.items.push(<span class="hljs-keyword">this</span>.text)
      <span class="hljs-keyword">this</span>.text = <span class="hljs-string">''</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"sass"</span> <span class="hljs-attr">scoped</span>&gt;</span>
$bg: #ccc;

.top {
  padding: 20px;
  background: $bg;
}
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<ul>
<li>创建 src/pages/Item.js</li>
</ul>
<pre class="hljs"><code><span class="hljs-comment">// pages/Item.js</span>
<span class="hljs-keyword">import</span> html <span class="hljs-keyword">from</span> <span class="hljs-string">'./Item.html'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">template</span>: html,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>
  }
}
</code></pre>
<ul>
<li>创建 src/pages/Item.html</li>
</ul>
<pre class="hljs"><code><span class="hljs-comment">&lt;!-- pages/Item.html --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>{{ name }}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>在浏览器访问 http://localhost:8686/</p>
<blockquote>
<p>以上例子演示了两种写 Vue 组件的方法</p>
<p>一、使用 .vue 文件，目前 .vue 文件只支持普通的 html/css/js 和 sass/pug ，不支持 less/typescript 等。注意 Layout.vue 的 pug ，首行第一个位置不能是空格，即不能缩进。</p>
<p>二、使用 html 和 js 两个文件写 Vue 组件，如果存在同路径同名的两个文件，例：Component.html 和 Component.js，则飘刃会把这两个文件处理成 Vue 组件。需要注意的是，这种方式的 html 文件不包括 script ，所以不需要 template 标签，直接写 div ，也不支持 pug。</p>
</blockquote>
<p>开发完成后，使用以下命令打包</p>
<pre class="hljs"><code>npm run build
</code></pre>
<p>打包完成后可在 dist 目录双击 index.html 到浏览器访问，如果项目包含 ajax 请求，file:// 协议文件无法跨域，可以在 dist 目录运行 pr1 start 8080 开启飘刃服务，在浏览器访问 http://localhost:8080/</p>
<h2>命令说明</h2>
<pre class="hljs"><code><span class="hljs-comment"># 创建项目，初始化工程文件</span>

pr1 init
</code></pre>
<pre class="hljs"><code><span class="hljs-comment"># 开启飘刃服务，在哪个目录开启，哪个目录就是根站点</span>
<span class="hljs-comment"># 可在浏览器访问该站点文件，相当于微型静态服务器</span>
<span class="hljs-comment"># 将会拦截所有带 pr1_module=1 参数的 url 进行文件处理</span>
<span class="hljs-comment"># 用于开发环境</span>

pr1 start [port] [config]

<span class="hljs-comment"># 示例</span>

pr1 start     <span class="hljs-comment"># 默认 8686 端口，工程根目录的 pr1.config.js 配置文件</span>
pr1 start 8080  <span class="hljs-comment"># 指定 8080 端口</span>
pr1 start --config=<span class="hljs-string">"./config.js"</span> <span class="hljs-comment"># 指定 ./config.js 配置文件</span>
pr1 start 8080 --config=<span class="hljs-string">"./config.js"</span> <span class="hljs-comment"># 指定端口和配置文件</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment"># 使用 build 命令打包，必须指定入口文件，只能是 html 和 js 文件</span>
<span class="hljs-comment"># 可以同时打包多个模块</span>
<span class="hljs-comment"># 如果是 html 文件，将会自动解决 html 里的入口文件及复制静态资源</span>
<span class="hljs-comment"># 如果是 js 文件，只会解决该 js 文件及其依赖，不会复制静态资源</span>
<span class="hljs-comment"># 入口文件目录与打包后的文件目录结构相同</span>

pr1 build [entry] [config]

<span class="hljs-comment"># 示例</span>

pr1 build index.html <span class="hljs-comment"># 使用默认配置文件打包</span>
pr1 build index.html --config=<span class="hljs-string">"./config.js"</span> <span class="hljs-comment"># 使用指定配置文件</span>
pr1 build index.html detail.html tools.js   <span class="hljs-comment"># 同时打包3个文件</span>
pr1 build index.html detail.html tools.js --config=<span class="hljs-string">"./config.js"</span> <span class="hljs-comment"># 使用指定配置打包3个文件</span>
pr1 build page1/index.html page2/index.html <span class="hljs-comment"># 在打包后也会保持同样结构</span>
</code></pre>
<h2>配置说明</h2>
<pre class="hljs"><code><span class="hljs-comment">// pr1.config.js</span>
<span class="hljs-keyword">const</span> nodeResolve = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rollup-plugin-node-resolve'</span>)
<span class="hljs-built_in">require</span>(<span class="hljs-string">'colors'</span>)

<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-comment">// vendor 子项的第一个值将会整合到 rollup 的 external</span>
  <span class="hljs-comment">// [0]是开发环境用的，[1]是生产环境用的，如果没有[1]生产环境也用[0]</span>
  <span class="hljs-attr">vendor</span>: [
    [<span class="hljs-string">'vue/dist/vue.esm.browser.js'</span>, <span class="hljs-string">'vue/dist/vue.runtime.min.js'</span>]
  ],
  <span class="hljs-comment">// true 表示存在同级目录且同名的 html 和 js 文件会被关联到一起</span>
  <span class="hljs-comment">// 转成 Vue render 组件提高性能，仅生产环境起作用</span>
  <span class="hljs-attr">html2VueRender</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-comment">// 热更新 true or reload，如果是字符串 reload，将会刷新浏览器而非 .vue 组件</span>
  <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-comment">// dist 打包后文件输出目录，路径应相对于当前配置文件</span>
  <span class="hljs-attr">dist</span>: <span class="hljs-string">''</span>,
  <span class="hljs-comment">// static 静态文件，路径应相对于 html 入口文件</span>
  <span class="hljs-attr">static</span>: [],
  <span class="hljs-comment">// rollup 选项，必须有</span>
  <span class="hljs-attr">rollupConfig</span>: {
    <span class="hljs-comment">// 定义了 vendor，再定义 globals，这样 rollup 会把相关的 vendor 转换成全局变量作为外部资源处理</span>
    <span class="hljs-attr">globals</span>: {
      <span class="hljs-string">'vue/dist/vue.esm.browser.js'</span>: <span class="hljs-string">'Vue'</span>
    },
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-comment">// rollup-plugin-node-resolve 用于解决引用 node_modules 资源路径</span>
      nodeResolve()
    ]
  },
  <span class="hljs-comment">// babel 选项，不提供将不会进行转码，不使用 uglify 压缩时，可安装 babel 的 minify 插件压缩</span>
  <span class="hljs-attr">babelConfig</span>: {
    <span class="hljs-attr">presets</span>: [
      [
        <span class="hljs-string">'@babel/env'</span>, {
          <span class="hljs-attr">modules</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">targets</span>: {
            <span class="hljs-attr">ie</span>: <span class="hljs-string">'9'</span>,
            <span class="hljs-attr">chrome</span>: <span class="hljs-string">'49'</span>
          }
        }
      ]
    ]
  },
  <span class="hljs-comment">// uglify 选项，不提供将不会压缩，如果 babel 转码后仍存在 ES6+ 代码，uglify 解释不了将会压缩失败</span>
  <span class="hljs-attr">uglifyConfig</span>: {
    <span class="hljs-attr">toplevel</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// 打包前的钩子</span>
  <span class="hljs-attr">beforeBuild</span>: <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">originDir</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`开始打包：`</span>.green + <span class="hljs-string">`<span class="hljs-subst">${originDir}</span>`</span>.cyan)
  },
  <span class="hljs-comment">// 打包后的钩子</span>
  <span class="hljs-attr">afterBuild</span>: <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">distDir</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`完成打包：`</span>.green + <span class="hljs-string">`<span class="hljs-subst">${distDir}</span>`</span>.cyan)
  }
}
</code></pre>
<h2>运作原理</h2>
<p>飘刃会拦截所有带有 pr1_module=1 参数的 url ，并处理对应的文件资源，目前只会处理 .vue .html .js 3种文件</p>
<p>把 import/export 转换成 async/await 让浏览器可以支持引入除 js 外的其它资源</p>
<p>飘刃会把非 js 资源通过 rollup 的插件转换成 js 资源再传到浏览器，开发环境只会调用 rollup 插件的 <code>resolveId</code> 和 <code>transform</code> 方法</p>
<p>import/export 转换关系如下：</p>
<pre class="hljs"><code><span class="hljs-comment">// import 规则</span>
<span class="hljs-keyword">import</span> { a, b, c } <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>             =&gt; <span class="hljs-keyword">const</span> { a, b, c } = <span class="hljs-keyword">await</span> _import(<span class="hljs-string">'./util.js'</span>)
<span class="hljs-keyword">import</span> { abc <span class="hljs-keyword">as</span> a, efg <span class="hljs-keyword">as</span> b } <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>  =&gt; <span class="hljs-keyword">const</span> { <span class="hljs-attr">abc</span>: a, <span class="hljs-attr">efg</span>: b } = <span class="hljs-keyword">await</span> _import(<span class="hljs-string">'./util.js'</span>)
<span class="hljs-keyword">import</span> a <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>                       =&gt; <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: a } = <span class="hljs-keyword">await</span> _import(<span class="hljs-string">'./util.js'</span>)
<span class="hljs-keyword">import</span> <span class="hljs-string">'./util.js'</span>                              =&gt; <span class="hljs-keyword">await</span> _import(<span class="hljs-string">'./util.js'</span>)
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>                  =&gt; <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> _import(<span class="hljs-string">'./util.js'</span>)
<span class="hljs-keyword">import</span> a, { efg <span class="hljs-keyword">as</span> b, c } <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>      =&gt; <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: a, <span class="hljs-attr">efg</span>: b, c } = <span class="hljs-keyword">await</span> _import(<span class="hljs-string">'./util.js'</span>)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">// export 规则</span>
 <span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> a = <span class="hljs-string">'xxx'</span>                           =&gt; <span class="hljs-keyword">var</span> a = exports.a = <span class="hljs-string">'xxx'</span>
 <span class="hljs-keyword">export</span> { a, b, c }                             =&gt; <span class="hljs-built_in">Object</span>.assign(exports, {a, b, c})
 <span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span> (<span class="hljs-params"></span>) </span>{}                        =&gt; exports.a = a; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span> (<span class="hljs-params"></span>) </span>{}
 <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> a                               =&gt; exports.default = a
 <span class="hljs-keyword">export</span> { abc <span class="hljs-keyword">as</span> a }                            =&gt; <span class="hljs-built_in">Object</span>.assign(exports, {<span class="hljs-attr">a</span>: abc} = { a })
 <span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">e</span> </span>{}                              =&gt; exports.e = e; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">e</span> </span>{}
 <span class="hljs-keyword">export</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> d } <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>       =&gt; <span class="hljs-built_in">Object</span>.assign(exports, <span class="hljs-keyword">await</span> (<span class="hljs-keyword">async</span> () =&gt; { <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: d
                                                   } = <span class="hljs-keyword">await</span> _import(<span class="hljs-string">'./util.js'</span>); <span class="hljs-keyword">return</span> { d }})())
</code></pre>
<h2>静态资源</h2>
<p>支持两种静态资源路径 以 <code>/</code> 开头和以 <code>.</code> 开头</p>
<ul>
<li><code>/</code> 开头的资源路径相对站点根目录</li>
<li><code>.</code> 开头的资源路径相对当前引用的文件</li>
</ul>
<p>如下目录结构</p>
<pre class="hljs"><code>src/
  |-- index.html
  |-- static/
    |-- images/
      |-- a.png
  |-- pages/
    |-- one/
      |-- two/
        |-- three/
          |-- a.vue <span class="hljs-comment"># background-url: /static/images/a.png</span>
    |-- b.html  <span class="hljs-comment"># img src="../static/images/a.png"</span>
    |-- b.js
</code></pre>
<p>绝对路径和相对路径都是引用同一张图片</p>
<p>支持组件多 style ，组件内 style 均为组件内样式，带 scoped 不会影响子组件，不带 scoped 会影响子组件，全局样式请用 link 标签引入</p>
<h2>多页应用</h2>
<p>飘刃处理多面应用非常简单，如下目录结构</p>
<pre class="hljs"><code>src/
  |-- page1/
    |-- index.html
  |-- page2/
    |-- index.html
  |-- page3/
    |-- index.html
</code></pre>
<p>开发环境，在 src 目录执行 <code>pr1 start</code></p>
<p>在浏览器分别访问</p>
<p>http://localhost:8686/page1/</p>
<p>http://localhost:8686/page2/</p>
<p>http://localhost:8686/page3/</p>
<p>生产环境，在 src 目录执行 <code>pr1 build page1/index.html page2/index.html page3/index.html</code></p>
<p>在 dist 目录会保持以下目录结构</p>
<pre class="hljs"><code>dist/
  |-- page1/
    |-- index.html
  |-- page2/
    |-- index.html
  |-- page3/
    |-- index.html
</code></pre>
<h2>支持 Typescript</h2>
<p>目前只支持引入 .ts 文件，.vue 组件的 type=ts 暂不支持</p>
<pre class="hljs"><code><span class="hljs-comment"># 安装</span>
npm i rollup-plugin-typescript typescript tslib
</code></pre>
<p>修改 pr1.config.js 添加 typescript 插件</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> typescript = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rollup-plugin-typescript'</span>)
<span class="hljs-comment">// ...</span>

<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">rollupConfig</span>: {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-attr">plugins</span>: [
      typescript({
        <span class="hljs-attr">target</span>: <span class="hljs-string">'ESNext'</span>,
      })
      <span class="hljs-comment">// ...</span>
    ]
  },
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h2>生产注释</h2>
<p>如下示例：</p>
<pre class="hljs"><code>doSome(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-comment">// pr1 ignore++</span>
  <span class="hljs-built_in">console</span>.info(<span class="hljs-string">`调试信息:<span class="hljs-subst">${data}</span>`</span>)
  <span class="hljs-comment">// pr1 ignore--</span>
  doIt(data)
})
</code></pre>
<p><code>// pr1 ignore++</code>到<code>// pr1 ignore--</code>的代码在生产环境会被删除</p>
<pre class="hljs"><code>doSome(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  doIt(data)
})
</code></pre>
<h2>注意事项</h2>
<ul>
<li>开发环境，js 文件只会替换 import 和 export ，如果 import('jroll') 导入的路径不能解释，将会使用 <code>rollup-plugin-node-resolve</code> 插件解决</li>
<li>如果要引用 node_modules 的文件，配置文件必须加载 rollup-plugin-node-resolve 插件</li>
<li>所有 js 文件的 import 引入的路径都必须带后缀，省略会出错</li>
<li>sass 的 <code>@import</code> 导入是相对于当前 sass 所在文件的，只支持 @import sass，暂不支持自动拷贝 @import css 的文件</li>
<li>如果要使用 sass 或 scoped，必须保持严格格式，只允许<code>&lt;style lang=&quot;sass&quot; scoped&gt;</code>、<code>&lt;style lang=&quot;sass&quot;&gt;</code>、<code>&lt;style scoped&gt;</code>，不允许<code>&lt;style scoped lang=&quot;sass&quot;&gt;</code>，同理如果要使用 pug ，必须书写成<code>&lt;template lang=&quot;pug&quot;&gt;</code>，不允许多空格或少空格</li>
<li>在 .vue 或 .html+js 组件里，不带 scoped 的 style 必须使用 this 做选择器处理最外层 dom 的样式，例</li>
</ul>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"abc"</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 不带 scoped 必须使用 this 表示最外层 dom 选择器 */</span>
<span class="hljs-selector-tag">this</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#efefef</span>;
}
<span class="hljs-selector-class">.abc</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 带 scoped 可以使用最外层 dom 的 class 来做选择器 */</span>
<span class="hljs-selector-class">.top</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">22px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<ul>
<li>
<p>如果同目录存在同名的 html 和 js 文件并开启 <code>html2VueRender</code> 选项，默认开启，则视为 Vue 组件，打包时会自动关联转成 render 函数。同名 js 文件只能用 template: html，不能用其它变量</p>
<pre class="hljs"><code><span class="hljs-comment">// html/js 的 Vue 组件只能用 html 作为变量名引入同名 html 文件</span>
<span class="hljs-keyword">import</span> html <span class="hljs-keyword">from</span> <span class="hljs-string">'./sameName.html'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">template</span>: html
}
</code></pre>
</li>
<li>
<p>在 html 里的 <code>&lt;img src=&quot;./..&quot;&gt;</code> 和 css 里的 <code>background:url(./..)</code> 小于 4k 的图片会自动转为 base64，无法自动解决的静态资源需要手动在 static 选项添加资源目录名或具体资源文件名，如下示例的资源不能自动处理</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"i in images"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"i.src"</span>&gt;</span>
</code></pre>
</li>
<li>
<p>js 文件或 vue 文件如果在行首要输入 <code>import xxx from</code> <code>export default</code> 这类字符串需要转义，或者使用字符串拼接不能让飘刃转换 import 和 export 的规则命中</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> str = <span class="hljs-string">`
import xxx from 'a.js'
export default { b: 1 }
`</span>
<span class="hljs-comment">// 要写成</span>
<span class="hljs-keyword">const</span> str = <span class="hljs-string">`
\u0069mport xxx from 'a.js'
\u0065xport default { b: 1 }
`</span>
<span class="hljs-comment">// 或</span>
<span class="hljs-keyword">const</span> str = <span class="hljs-string">`
i`</span> + <span class="hljs-string">`mport xxx from 'a.js'
e`</span> + <span class="hljs-string">`xport default { b: 1 }
`</span>
</code></pre>
</li>
</ul>
<h2>常见错误</h2>
<ul>
<li>
<p>运行 <code>pr1 start</code> 出错</p>
<blockquote>
<p><code>Error: listen EADDRINUSE :::8686</code></p>
<p><code>at Server.setupListenHandle [as _listen2] (net.js:1335:14)</code></p>
<p><code>at listenInCluster (net.js:1383:12)</code></p>
</blockquote>
<p>8686 端口被占用，解决方案：指定端口运行或先关闭占用 8686 端口的程序</p>
</li>
<li>
<p>运行 <code>pr1 build</code> 出错</p>
<blockquote>
<p><code>(node:20976) UnhandledPromiseRejectionWarning: Error: EBUSY: resource busy or locked, rmdir 'D:\xx\dist'</code></p>
</blockquote>
<p>dist 目录繁忙或锁定，无法删除。解决方案：检查 dist/index.html 是否在浏览器中打开，将其关闭再重新打包</p>
</li>
</ul>
<h2>更新日志</h2>
<p>### v0.3.16 (2020-04-11)</p>
<ul>
<li>修复<code>exports { default } from 'xxx'</code>解释报<code>default</code>是保留字的错误问题</li>
</ul>
<p>### (2019-12-30)</p>
<ul>
<li>
<p>v0.3.15</p>
<ul>
<li>修复<code>class a extend b</code>格式解释错误的问题</li>
</ul>
</li>
<li>
<p>v0.3.14</p>
<ul>
<li>支持<code>export * from 'xxx'</code>格式</li>
<li>解决<code>module.exports=</code> exports 被修改的问题</li>
<li>修复某些 node_modules 模块路径识别错误的问题</li>
<li>修复<code>export { a, b as bb }</code>带有 as 和无 as 混合格式导出</li>
<li>修复手动清空浏览器缓存出现白屏的问题</li>
</ul>
</li>
</ul>
<p>### v0.3.13 (2019-12-07)</p>
<ul>
<li>添加缓存，整体速度提升</li>
<li>修复sass不带括号解释失败的问题</li>
</ul>
<p>### v0.3.12 (2019-10-29)</p>
<ul>
<li>更好的支持 Typescript</li>
</ul>
<p>### v0.3.11 (2019-10-04)</p>
<ul>
<li>修复import有as和没as混合解释出错的bug</li>
</ul>
<p>### v0.3.10 (2019-08-12)</p>
<ul>
<li>将cookie传参改回url传参，解决初次加载空白页的问题</li>
<li>修复在没config.js的目录跑<code>pr1 start</code>报错的问题</li>
</ul>
<p>### v0.3.9 (2019-06-28)</p>
<ul>
<li>小优化</li>
</ul>
<p>### (2019-06-02)</p>
<ul>
<li>
<p>v0.3.8</p>
<ul>
<li>添加对 require 的转换</li>
<li>添加支持 node_modules 文件无后缀的 vue/mjs/json 文件路径</li>
<li>修复 .vue 文件 template 里含 template 标签解释错误的问题</li>
<li>修复 <code>export const a =</code> 在本文件不起作用的 bug</li>
</ul>
</li>
<li>
<p>v0.3.7</p>
<ul>
<li>修复 html 文件带 ` 字符时出错的bug</li>
<li>修复 script 带 type 属性解释不了的问题</li>
</ul>
</li>
<li>
<p>v0.3.6</p>
</li>
<li>
<p>添加模块 rollup-plugin-paths 路径别称支持</p>
</li>
<li>
<p>添加支持 node_modules 模块无后缀名资源的引入</p>
</li>
<li>
<p>修复 <code>export {</code> 以 { 结尾的导出语法解释错误</p>
</li>
<li>
<p>修复文本内容带 <code>{{content}}amp;</code> <code>$</code> 等特殊字符替换文本出错的 bug</p>
</li>
</ul>
<p>### v0.3.5 (2019-05-26)</p>
<ul>
<li>修复 .vue 热更新修改父组件后子组件无法更新的 bug</li>
</ul>
<p>### (2019-05-25)</p>
<ul>
<li>
<p>v0.3.4</p>
<ul>
<li>复偶尔不能监测热更新的 bug</li>
</ul>
</li>
<li>
<p>v0.3.3</p>
<ul>
<li>修复 template 不是 pug 时出错的bug</li>
</ul>
</li>
</ul>
<p>### (2019-05-24)</p>
<ul>
<li>
<p>v0.3.2</p>
<ul>
<li>修复引入 node_modules 模块里的 css 文件没有解释的 bug</li>
</ul>
</li>
<li>
<p>v0.3.1</p>
<ul>
<li>支持 import css 或 sass 文件</li>
</ul>
</li>
</ul>
<p>### v0.3.0 (2019-05-23)</p>
<ul>
<li>支持 .vue 组件的热加载</li>
<li>删除 hot 选项的 'style' ，改为 true</li>
<li>修复改为 cookie 带参后首次加载会白屏的问题</li>
<li>修复引入相同路径的 node_modules 资源产生两个不同资源的 bug</li>
</ul>
<p>### (2019-05-22)</p>
<ul>
<li>
<p>v0.2.13</p>
<ul>
<li>修复 cookie 为 undefined 时出错的 bug</li>
</ul>
</li>
<li>
<p>v0.2.12</p>
<ul>
<li>使用 cookie 传参替换 url 传参，使文件路径清爽</li>
<li>修复 v0.2.11 打包没有 css 的 bug</li>
</ul>
</li>
<li>
<p>v0.2.11</p>
<ul>
<li>修复样式对 :: 伪元素的支持</li>
<li>支持组件多 style ，组件内 style 均为组件内样式，带 scoped 不会影响子组件，不带 scoped 会影响子组件，全局样式请用 link 标签引入</li>
<li>优化 <code>hot: 'style'</code> 选项</li>
</ul>
</li>
</ul>
<p>### v0.2.10 (2019-05-12)</p>
<ul>
<li>支持 .vue 文件的 <code>export default Vue.extend({</code> 等语法</li>
</ul>
<p>### v0.2.9 (2019-05-08)</p>
<ul>
<li>修复 import 语句后面带 ; 号解释出错的问题</li>
</ul>
<p>### (2019-05-06)</p>
<ul>
<li>
<p>v0.2.8 修复 v0.2.1 优化项目文件结构产生引用 某些 js 路径错误的问题</p>
</li>
<li>
<p>v0.2.7</p>
<ul>
<li>改回使用 Object.freeze 冻结 exports</li>
<li>html 输入使用 ` 反引符保持格式</li>
<li>修复 html 文件里的 import 和 export 字符串也被转换的问题</li>
<li>更新注意事项</li>
</ul>
</li>
</ul>
<p>### v0.2.6 (2019-05-04)</p>
<ul>
<li>默认 vue.min.js 改为体积更小的 vue.runtime.min.js</li>
<li>修复 <code>export function abc</code> 开发阶段同文件其它函数访问不了 <code>abc()</code> 的问题</li>
<li>解除 Object.freeze 将整个 exports 冻结，用 Object.defineProperty 处理局部常量</li>
</ul>
<p>### (2019-05-02)</p>
<ul>
<li>v0.2.2 修复 v0.2.1 错误 npm 包</li>
<li>v0.2.3 修复 没有默认 index.html 的问题</li>
<li>v0.2.4 修复 hot reload 选项失效的问题</li>
<li>v0.2.5 修复 exports 导出的属性会被修改的问题（使用 Object.freeze）</li>
</ul>
<p>### v0.2.1 (2019-04-30)</p>
<ul>
<li>添加支持 rollup 插件的 <code>resolveId</code> 方法</li>
<li>优化项目文件结构</li>
<li>支持静态文件使用相对路径相对于当前引用文件</li>
</ul>
<p>### v0.2.0 (2019-04-29)</p>
<ul>
<li>添加支持 <code>import a, { b, c } ...</code> 和 <code>export { a } from ...</code> 语法</li>
<li>添加支持少于4k的图片压缩成base64</li>
<li>添加 html 和 css 里的图片资源自动拷贝到相应的静态文件夹的功能</li>
<li>添加 html2VueRender 选项，默认开启，即 html 和 js 同级目录且同名 html 会转成 Vue render 函数</li>
<li>解决 sass 使用 <code>@import</code> 导入路径问题</li>
</ul>
<p>### v0.1.1 (2019-04-26)</p>
<ul>
<li>添加热更新 hot 选项，只支持更新 style 或 reload 刷新页面两种方式</li>
<li>更新文档，添加和 vue-cli 的对比</li>
</ul>
<p>### v0.0.10 (2019-04-24)</p>
<ul>
<li>完成文档，上线</li>
</ul>
<h2>攒助作者</h2>
<p>支持作者继续维护更新，编写更多教程和使用技巧。如果有足够的支持，飘刃将来将会支持 React、TypeScript、异步模块等等。</p>
<p><strong>支持方式</strong></p>
<p>打赏1块几毛钱，让作者不用去天桥底蹲位</p>
<img src="https://goodgoodsbook.com/imgs/alipay.jpg" width="300">
<img src="https://goodgoodsbook.com/imgs/wxpay.png" width="300">
<div style="clear:both;height:24px;"></div>
<h2>开源协议</h2>
<p>MIT</p>
</div>
  <div id="ad">
    <a class="big" target="_blank" href="https://www.taptap.com/app/174349">
      <img src="https://www.chjtx.com/assets/images/gg-big3.jpg">
    </a>
    <a class="small" target="_blank" href="https://www.taptap.com/app/174349">
      <img src="https://www.chjtx.com/assets/images/gg-small3.jpg">
    </a>
  </div>
</body>
</html>
